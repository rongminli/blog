<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>策略模式 | LRM的笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5ce66c8b.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f0d3d57.js" as="script"><link rel="preload" href="/blog/assets/js/2.31e7eaac.js" as="script"><link rel="preload" href="/blog/assets/js/16.5e408412.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.e0c34b25.js"><link rel="prefetch" href="/blog/assets/js/11.9733fdbe.js"><link rel="prefetch" href="/blog/assets/js/12.f38b06d4.js"><link rel="prefetch" href="/blog/assets/js/13.4623a3ca.js"><link rel="prefetch" href="/blog/assets/js/14.8667e4ef.js"><link rel="prefetch" href="/blog/assets/js/15.3351213e.js"><link rel="prefetch" href="/blog/assets/js/17.21e2ea52.js"><link rel="prefetch" href="/blog/assets/js/18.9e4522ec.js"><link rel="prefetch" href="/blog/assets/js/19.90702316.js"><link rel="prefetch" href="/blog/assets/js/20.fec304cd.js"><link rel="prefetch" href="/blog/assets/js/21.ae45e28a.js"><link rel="prefetch" href="/blog/assets/js/22.82fabc13.js"><link rel="prefetch" href="/blog/assets/js/23.83200369.js"><link rel="prefetch" href="/blog/assets/js/24.4c33f372.js"><link rel="prefetch" href="/blog/assets/js/3.71d7076e.js"><link rel="prefetch" href="/blog/assets/js/4.81286938.js"><link rel="prefetch" href="/blog/assets/js/5.5cbb8dc4.js"><link rel="prefetch" href="/blog/assets/js/6.15c032ef.js"><link rel="prefetch" href="/blog/assets/js/7.72825ffb.js"><link rel="prefetch" href="/blog/assets/js/8.eac49056.js"><link rel="prefetch" href="/blog/assets/js/9.1107ed4b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5ce66c8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">LRM的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/blog/design_pattern/singleton.html" class="sidebar-link">单例模式</a></li><li><a href="/blog/design_pattern/strategy.html" aria-current="page" class="active sidebar-link">策略模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/design_pattern/strategy.html#一个例子" class="sidebar-link">一个例子</a></li><li class="sidebar-sub-header"><a href="/blog/design_pattern/strategy.html#策略模式的优缺点" class="sidebar-link">策略模式的优缺点</a></li></ul></li><li><a href="/blog/design_pattern/observer.html" class="sidebar-link">发布订阅模式（观察者模式)</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="策略模式"><a href="#策略模式" class="header-anchor">#</a> 策略模式</h1> <p><strong>策略模式指的是定义一系列的算法，把它们一个个封装起来</strong>。将不变的部分和变化的部分隔开是每个设计模式的主题，策略模式也不例外，<strong>策略模式的目的就是将算法的使用与算法的实现分离开来。</strong></p> <h2 id="一个例子"><a href="#一个例子" class="header-anchor">#</a> 一个例子</h2> <p>在编程工作中，我们往往需要根据不同的情形，组合不同的策略，去完成同一个目标。</p> <p>例如前端开发中的输入校验，用户名、密码、电话号码或者邮箱等等都需要使用不同的校验策略，但是我们最终的目的都是要知道当前的输入是否合法。</p> <p>现在假设我们正在编写一个注册的页面，在点击注册按钮之前，有如下几条校验逻辑。</p> <ul><li>用户名不能为空。</li> <li>密码长度不能少于 6 位。</li> <li>手机号码必须符合格式。</li></ul> <p>我们把这些规则封装成不同的策略，代码如下。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">var</span> strategies <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">isNonEmpty</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> errorMsg
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">minLength</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> length<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> errorMsg
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isMobile</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> errorMsg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(^1[3|5|8][0-9]{9}$)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>  value <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>接下来我们准备实现 Validator 类。Validator 类在这里作为 Context，负责接收用户的请求并委托给 strategy 对象。在给出 Validator 类的代码之前，有必要提前了解用户是如何向 Validator类发送请求的，这有助于我们知道如何去编写 Validator 类的代码。代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">validataFunc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Validator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'isNonEmpty'</span><span class="token punctuation">,</span> <span class="token string">'用户名不能为空'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>password<span class="token punctuation">,</span> <span class="token string">'minLength:8'</span><span class="token punctuation">,</span> <span class="token string">'密码长度不能小于八位'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'phoneNumber'</span><span class="token punctuation">,</span> <span class="token string">'手机号码格式不正确'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> result <span class="token operator">=</span> validator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> errorMsg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> registerForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'registerForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
registerForm<span class="token punctuation">.</span><span class="token function-variable function">onsubmit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> errorMsg <span class="token operator">=</span> <span class="token function">validataFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">aller</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>最后是 Validator 类的实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">Validator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">dom<span class="token punctuation">,</span> rule<span class="token punctuation">,</span> errorMsg</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ary <span class="token operator">=</span> rule<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> strategy <span class="token operator">=</span> ary<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ary<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span> dom<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">;</span>
        ary<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span> errorMsg <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> strategies<span class="token punctuation">[</span> strategy <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span> dom<span class="token punctuation">,</span> ary <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Validator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> validatorFunc<span class="token punctuation">;</span> validatorFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> msg <span class="token operator">=</span> <span class="token function">validatorFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> msg
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>使用策略模式重构代码之后，我们仅仅通过“配置”的方式就可以完成一个表单的校验，
这些校验规则也可以复用在程序的任何地方，还能作为插件的形式，方便地被移植到其他项
目中。
在修改某个校验规则的时候，只需要编写或者改写少量的代码。比如我们想将用户名输入框
的校验规则改成用户名不能少于 4 个字符。可以看到，这时候的修改是毫不费力的。代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'isNonEmpty'</span><span class="token punctuation">,</span> <span class="token string">'用户名不能为空'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 改成：</span>
validator<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> registerForm<span class="token punctuation">.</span>userName<span class="token punctuation">,</span> <span class="token string">'minLength:10'</span><span class="token punctuation">,</span> <span class="token string">'用户名长度不能小于 10 位'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="策略模式的优缺点"><a href="#策略模式的优缺点" class="header-anchor">#</a> 策略模式的优缺点</h2> <p>策略模式是一种常用且有效的设计模式，本章提供了计算奖金、缓动动画、表单校验这三个
例子来加深大家对策略模式的理解。从这三个例子中，我们可以总结出策略模式的一些优点。</p> <ul><li>策略模式利用组合、委托和多态等技术和思想，可以有效地避免多重条件选择语句。</li> <li>策略模式提供了对开放—封闭原则的完美支持，将算法封装在独立的 strategy 中，使得它
们易于切换，易于理解，易于扩展。</li> <li>策略模式中的算法也可以复用在系统的其他地方，从而避免许多重复的复制粘贴工作。</li> <li>在策略模式中利用组合和委托来让 Context 拥有执行算法的能力，这也是继承的一种更轻
便的替代方案。
当然，策略模式也有一些缺点，但这些缺点并不严重。
首先，使用策略模式会在程序中增加许多策略类或者策略对象，但实际上这比把它们负责的
逻辑堆砌在 Context 中要好。
其次，要使用策略模式，必须了解所有的 strategy，必须了解各个 strategy 之间的不同点，
这样才能选择一个合适的 strategy。比如，我们要选择一种合适的旅游出行路线，必须先了解选
择飞机、火车、自行车等方案的细节。此时 strategy 要向客户暴露它的所有实现，这是违反最少
知识原则的。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/design_pattern/singleton.html" class="prev">
        单例模式
      </a></span> <span class="next"><a href="/blog/design_pattern/observer.html">
        发布订阅模式（观察者模式)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.9f0d3d57.js" defer></script><script src="/blog/assets/js/2.31e7eaac.js" defer></script><script src="/blog/assets/js/16.5e408412.js" defer></script>
  </body>
</html>
