<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用String存储utf-8编码的文本 | LRM的笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5ce66c8b.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f0d3d57.js" as="script"><link rel="preload" href="/blog/assets/js/2.31e7eaac.js" as="script"><link rel="preload" href="/blog/assets/js/22.82fabc13.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.e0c34b25.js"><link rel="prefetch" href="/blog/assets/js/11.9733fdbe.js"><link rel="prefetch" href="/blog/assets/js/12.f38b06d4.js"><link rel="prefetch" href="/blog/assets/js/13.4623a3ca.js"><link rel="prefetch" href="/blog/assets/js/14.8667e4ef.js"><link rel="prefetch" href="/blog/assets/js/15.3351213e.js"><link rel="prefetch" href="/blog/assets/js/16.5e408412.js"><link rel="prefetch" href="/blog/assets/js/17.21e2ea52.js"><link rel="prefetch" href="/blog/assets/js/18.9e4522ec.js"><link rel="prefetch" href="/blog/assets/js/19.90702316.js"><link rel="prefetch" href="/blog/assets/js/20.fec304cd.js"><link rel="prefetch" href="/blog/assets/js/21.ae45e28a.js"><link rel="prefetch" href="/blog/assets/js/23.83200369.js"><link rel="prefetch" href="/blog/assets/js/24.4c33f372.js"><link rel="prefetch" href="/blog/assets/js/3.71d7076e.js"><link rel="prefetch" href="/blog/assets/js/4.81286938.js"><link rel="prefetch" href="/blog/assets/js/5.5cbb8dc4.js"><link rel="prefetch" href="/blog/assets/js/6.15c032ef.js"><link rel="prefetch" href="/blog/assets/js/7.72825ffb.js"><link rel="prefetch" href="/blog/assets/js/8.eac49056.js"><link rel="prefetch" href="/blog/assets/js/9.1107ed4b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5ce66c8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">LRM的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/blog/rust/6_enums_and_pattern_matching/index" class="sidebar-heading clickable open"><span>第六章 枚举和模式匹配</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/rust/6_enums_and_pattern_matching/6.1_define_an_enum.html" class="sidebar-link">6.1 枚举的创建和Option&lt;T&gt;</a></li><li><a href="/blog/rust/6_enums_and_pattern_matching/6.2_The_match_control_flow_construct.html" class="sidebar-link">6.2 匹配控制流结构</a></li><li><a href="/blog/rust/6_enums_and_pattern_matching/6.3_concise_control_flow_with_if_let.html" class="sidebar-link">6.3 简明控制流if let</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/blog/rust/8_common_collections/index" class="sidebar-heading clickable"><span>第六章 常用集合</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用string存储utf-8编码的文本"><a href="#使用string存储utf-8编码的文本" class="header-anchor">#</a> 使用String存储utf-8编码的文本</h1> <p>我们在第4章中讨论了字符串，但现在我们将更深入地研究它们。新的Rustaceans通常会因为三个原因而卡在字符串上:Rust倾向于暴露可能的错误，字符串的数据结构比许多程序员认为的更复杂，以及UTF-8。当您使用其他编程语言时，这些因素结合在一起可能会显得很困难。</p> <p>我们在集合的上下文中讨论字符串，因为字符串被实现为字节的集合，加上一些方法，在这些字节被解释为文本时提供有用的功能。在本节中，我们将讨论每种集合类型都具有的<code>String</code>上的操作，例如创建、更新和读取。我们还将讨论<code>String</code>与其他集合的不同之处，即由于人和计算机解释<code>String</code>数据的方式不同，索引到String是如何变得复杂的。</p> <h2 id="什么是string"><a href="#什么是string" class="header-anchor">#</a> 什么是String？</h2> <p>我们首先定义术语字符串的含义。Rust在核心语言中只有一个字符串类型，这就是字符串片str，通常以其借用的形式&amp;str出现。在第4章中，我们讨论了字符串片，它是对存储在其他地方的一些UTF-8编码的字符串数据的引用。例如，字符串字面值存储在程序的二进制文件中，因此是字符串片。</p> <p>String类型是由Rust的标准库提供的，而不是编码到核心语言中，它是一种可增长的、可变的、拥有的、UTF-8编码的字符串类型。当Rustaceans在Rust中引用“字符串”时，他们可能指的是String或字符串切片&amp;str类型，而不仅仅是其中一种类型。虽然本节主要是关于String的，但这两种类型在Rust的标准库中都有大量使用，而且String和字符串片都是UTF-8编码的。</p> <h2 id="创建一个新的string"><a href="#创建一个新的string" class="header-anchor">#</a> 创建一个新的String</h2> <p><code>Vec&lt;T&gt;</code>中可用的许多相同的操作也可用于String，因为String实际上是作为一个字节向量的包装器实现的，具有一些额外的保证、限制和功能。与<code>Vec&lt;T&gt;</code>和String以相同方式工作的一个函数示例是创建实例的新函数，如清单8-11所示。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>清单8-11:创建一个新的空<code>String</code></p> <p>这一行创建了一个名为<code>s</code>的新空字符串，然后我们可以将数据加载到其中。通常，我们会有一些初始数据，我们想用它们开始创建字符串。为此，我们使用<code>to_string</code>方法，该方法可用于实现<code>Display</code>特征的任何类型，就像字符串字面量一样。清单8-12显示了两个示例。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> s <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// the method also works on a literal directly:</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>清单8-12:使用<code>to_string</code>方法从字符串字面量创建<code>String</code></p> <p>上面的代码创建了一个包含<code>initial contents</code>的字符串。</p> <p>我们也可以使用<code>String::from</code>方法来通过字面量创建<code>String</code>。清单8-13中的代码等价于清单8-12中使用<code>to_string</code>的代码。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;initial contents&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>清单8-13:使用<code>String::from</code>函数从字符串字面量创建一个<code>String</code></p> <p>因为字符串被用于如此多的事情，我们可以为字符串使用许多不同的通用api，这为我们提供了许多选项。有些可能看起来多余，但它们都有自己的位置!在本例中，<code>String::from</code>和<code>to_string</code>执行相同的操作，因此选择哪一个取决于对样式和可读性的考量。</p> <p>记住，字符串是UTF-8编码的，因此可以在其中包含任何正确编码的数据，如清单8-14所示。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;السلام عليكم&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Dobrý den&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;שָׁלוֹם&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;नमस्ते&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;こんにちは&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;안녕하세요&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Olá&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Здравствуйте&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>清单8-14:在字符串中存储不同语言的问候语</p> <p>所有这些都是有效的<code>String</code>值。</p> <h2 id="更新string"><a href="#更新string" class="header-anchor">#</a> 更新String</h2> <p>String可以增加大小，它的内容可以改变，就像<code>Vec&lt;T&gt;</code>的内容一样，如果您将更多的数据推入其中。此外，您还可以方便地使用+操作符或<code>format!</code>宏连接字符串值。</p> <h3 id="使用push-str和push在末尾添加字符串"><a href="#使用push-str和push在末尾添加字符串" class="header-anchor">#</a> 使用<code>push_str</code>和<code>push</code>在末尾添加字符串</h3> <p>我们可以通过使用<code>push_str</code>方法来增加一个字符串片，如清单8-15所示。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>清单8-15:使用<code>push_str</code>方法将字符串片追加到<code>string</code></p> <p>在这两行之后，s将包含foobar。<code>push_str</code>方法接受一个字符串片，因为我们不一定想获得参数的所有权。在清单8-16的代码中，我们希望能够在将s2的内容追加到s1之后使用s2。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2 is {}&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>清单8-16:在将内容追加到<code>string</code>之后使用字符串片</p> <p>如果push_str方法拥有s2的所有权，我们将无法在最后一行打印它的值。然而，这段代码按照我们的预期工作!</p> <p><code>push</code>方法将单个字符作为参数并将其添加到<code>String</code>中。清单8-17使用<code>push</code>方法将字母“l”添加到<code>String</code>中。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;lo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">'l'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>清单8-17:使用push向String值添加一个字符</p> <p>结果，<code>s</code>将包含<code>lol</code>。</p> <h3 id="用-运算符或format-宏拼接"><a href="#用-运算符或format-宏拼接" class="header-anchor">#</a> 用+运算符或<code>format!</code>宏拼接</h3> <p>通常，您会希望合并两个现有的字符串。一种方法是使用+操作符，如清单8-18所示。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;world!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s3 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">;</span> <span class="token comment">// note s1 has been moved here and can no longer be used</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>清单8-18:使用+运算符将两个<code>String</code>值合并为一个新的<code>String</code>值</p> <p>字符串<code>s3</code>将包含<code>Hello, world</code>! <code>s1</code>在加法之后不再有效的原因，以及我们使用s2的引用的原因，都与使用+操作符时调用的方法的签名有关。+操作符使用add方法，其签名如下:</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在标准库中，您将看到使用泛型和相关类型定义的<code>add</code>。在这里，我们写上了具体的类型，这是当我们用String值调用这个方法时发生的情况。我们将在第10章讨论泛型。这个签名为我们提供了理解+运算符的复杂部分所需的线索。</p> <p>首先，<code>s2</code>有一个<code>&amp;</code>，这意味着我们将第二个字符串的引用添加到第一个字符串。这是因为add函数中的s形参:我们只能在<code>String</code>对象中添加<code>&amp;str</code>;我们不能把两个<code>String</code>值相加。但是等等——<code>&amp;s2</code>的类型是<code>&amp;String</code>，而不是要添加的第二个参数中指定的<code>&amp;str</code>。那么为什么清单8-18通过了编译呢?</p> <p>我们能够在<code>add</code>调用中使用<code>&amp;s2</code>的原因是编译器可以将<code>&amp;String</code>参数强制转换为<code>&amp;str</code>。当我们调用<code>add</code>方法时，Rust使用deref强制，在这里将<code>&amp;s2</code>变成<code>&amp;s2[..]</code>。我们将在第15章更深入地讨论deref强制。因为<code>add</code>不拥有<code>s</code>形参的所有权，所以<code>s2</code>在此操作之后仍然是一个有效的<code>String</code>。</p> <p>其次，我们可以在签名中看到<code>add</code>拥有<code>self</code>的所有权，因为<code>self</code>没有<code>&amp;</code>。这意味着清单8-18中的<code>s1</code>将被移动到<code>add</code>调用中，在此之后将不再有效。虽然<code>s3 = s1 + &amp;s2;</code>看起来它将复制两个字符串并创建一个新的字符串，但是这个语句实际上获得<code>s1</code>的所有权，追加<code>s2</code>内容的副本，然后返回结果的所有权。换句话说，它看起来复制了很多拷贝，但实际上并没有;这个实现比复制更有效。</p> <p>如果我们需要连接多个字符串，+操作符的行为会变得笨拙:</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tac&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;toe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s2 <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s3<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在这一点上，<code>s</code>将是井字游戏。使用所有的<code>+</code>和<code>&quot;</code>字符，很难看到发生了什么。对于更复杂的字符串组合，我们可以使用<code>format!</code>宏:</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tac&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;toe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;{}-{}-{}&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这段代码还将<code>s</code>设置为<code>tic-tac-toe</code>。<code>format!</code>宏的工作方式和<code>println!</code>一样，但它不是将输出打印到屏幕上，而是返回一个包含内容的<code>String</code>。这个版本的代码使用<code>format!</code>更容易阅读，并由代码生成<code>format!</code>宏使用引用，因此这个调用不会获得它的任何参数的所有权。</p> <h2 id="string的索引"><a href="#string的索引" class="header-anchor">#</a> String的索引</h2> <p>在许多其他编程语言中，通过索引引用字符串中的各个字符是一种有效且常见的操作。但是，如果您试图使用Rust中的索引语法访问<code>String</code>的部分内容，则会得到一个错误。考虑清单8-19中的无效代码。</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>清单8-19:尝试对<code>String</code>使用索引语法</p> <p>此代码将导致以下错误:</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code>$ <span class="token function">cargo</span> run
   Compiling collections v0.1.0 <span class="token punctuation">(</span>file:///projects/collections<span class="token punctuation">)</span>
error<span class="token punctuation">[</span>E0277<span class="token punctuation">]</span>: the <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span>String<span class="token variable">`</span></span> cannot be indexed by <span class="token variable"><span class="token variable">`</span><span class="token punctuation">{</span>integer<span class="token punctuation">}</span><span class="token variable">`</span></span>
 --<span class="token operator">&gt;</span> src/main.rs:3:13
  <span class="token operator">|</span>
<span class="token number">3</span> <span class="token operator">|</span>     <span class="token builtin class-name">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token operator">|</span>             ^^^^^ <span class="token variable"><span class="token variable">`</span>String<span class="token variable">`</span></span> cannot be indexed by <span class="token variable"><span class="token variable">`</span><span class="token punctuation">{</span>integer<span class="token punctuation">}</span><span class="token variable">`</span></span>
  <span class="token operator">|</span>
  <span class="token operator">=</span> help: the trait <span class="token variable"><span class="token variable">`</span>Index<span class="token operator">&lt;</span><span class="token punctuation">{</span>integer<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token variable">`</span></span> is not implemented <span class="token keyword">for</span> <span class="token variable"><span class="token variable">`</span>String<span class="token variable">`</span></span>
  <span class="token operator">=</span> help: the following other types implement trait <span class="token variable"><span class="token variable">`</span>Index<span class="token operator">&lt;</span>Idx<span class="token operator">&gt;</span><span class="token variable">`</span></span><span class="token builtin class-name">:</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>RangeFrom<span class="token operator">&lt;</span>usize<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>RangeFull<span class="token operator">&gt;&gt;</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>RangeInclusive<span class="token operator">&lt;</span>usize<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>RangeTo<span class="token operator">&lt;</span>usize<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>RangeToInclusive<span class="token operator">&lt;</span>usize<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>String as Index<span class="token operator">&lt;</span>std::ops::Range<span class="token operator">&lt;</span>usize<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>str as Index<span class="token operator">&lt;</span>I<span class="token operator">&gt;&gt;</span>

For <span class="token function">more</span> information about this error, try <span class="token variable"><span class="token variable">`</span>rustc <span class="token parameter variable">--explain</span> E0277<span class="token variable">`</span></span><span class="token builtin class-name">.</span>
error: could not compile <span class="token variable"><span class="token variable">`</span>collections<span class="token variable">`</span></span> due to previous error
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>错误和注释说明了一切:Rust字符串不支持索引。但为什么不呢?要回答这个问题，我们需要讨论Rust如何在内存中存储字符串。</p> <h3 id="内部特征"><a href="#内部特征" class="header-anchor">#</a> 内部特征</h3> <p><code>String</code>是<code>Vec&lt;u8&gt;</code>的包装器。让我们看看清单8-14中一些正确编码的UTF-8示例字符串。首先，这个:</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.9f0d3d57.js" defer></script><script src="/blog/assets/js/2.31e7eaac.js" defer></script><script src="/blog/assets/js/22.82fabc13.js" defer></script>
  </body>
</html>
